{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/utils.ts"],"names":[],"mappings":";;;AAAA,iCAAyB;AACzB,MAAM,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAA;AAEhC,SAAgB,GAAG,CAAC,GAAW;IAC3B,OAAO,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;AAC7D,CAAC;AAFD,kBAEC;AAED,SAAgB,aAAa,CAAC,MAAW,EAAE,YAAoB;IAC3D,MAAM,YAAY,GAAG,IAAI,eAAe,CAAC,MAAM,CAAC,CAAA;IAChD,YAAY,CAAC,IAAI,EAAE,CAAA;IACnB,MAAM,WAAW,GAAG,YAAY,CAAC,QAAQ,EAAE,CAAA;IAC3C,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAA;IACzC,MAAM,KAAK,GAAG,GAAG,CAAC,GAAG,WAAW,QAAQ,GAAG,GAAG,YAAY,EAAE,CAAC,CAAA;IAC7D,OAAO,GAAG,MAAM,UAAU,KAAK,QAAQ,GAAG,EAAE,CAAA;AAChD,CAAC;AAPD,sCAOC;AAEM,KAAK,UAAU,eAAe,CAAC,MAAe;IACjD,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,MAAM,eAAK,CAAC,OAAO,CAAC;QAC9C,GAAG,EAAE,8CAA8C;QACnD,OAAO,EAAE;YACL,OAAO,EAAE,2BAA2B;YACpC,MAAM,EAAE,MAAM;YACd,YAAY,EACR,2HAA2H;SAClI;KACJ,CAAC,CAAA;IACF,MAAM,MAAM,GAAG,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAA;IAC/C,MAAM,MAAM,GAAG,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAA;IAC/C,MAAM,CAAC,GACH,MAAM;SACD,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC;SACrD,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAClB,MAAM;aACD,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC;aACrD,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;IACtB,MAAM,IAAI,GAAG,MAAM,eAAK,CAAC,OAAO,CAAC;QAC7B,GAAG,EAAE,gEAAgE;QACrE,OAAO,EAAE;YACL,OAAO,EAAE,8BAA8B;YACvC,YAAY,EACR,2HAA2H;SAClI;KACJ,CAAC,CAAA;IACF,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC,CAAA;IAChE,MAAM,CAAC,GAAa,EAAE,CAAA;IACtB,KAAK,CAAC,OAAO,CAAC,CAAC,CAAS,EAAE,EAAE;QACxB,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAA;IACtC,CAAC,CAAC,CAAA;IACF,OAAO,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAA;AAClC,CAAC;AAjCD,0CAiCC","sourcesContent":["import axios from 'axios'\nconst crypto = require('crypto')\n\nexport function md5(str: string) {\n    return crypto.createHash('md5').update(str).digest('hex')\n}\n\nexport function addVerifyInfo(params: any, verifyString: string) {\n    const searchParams = new URLSearchParams(params)\n    searchParams.sort()\n    const verifyParam = searchParams.toString()\n    const wts = Math.round(Date.now() / 1000)\n    const w_rid = md5(`${verifyParam}&wts=${wts}${verifyString}`)\n    return `${params}&w_rid=${w_rid}&wts=${wts}`\n}\n\nexport async function getVerifyString(cookie?: string) {\n    const { data: navResponse } = await axios.request({\n        url: `https://api.bilibili.com/x/web-interface/nav`,\n        headers: {\n            Referer: 'https://www.bilibili.com/',\n            Cookie: cookie,\n            'user-agent':\n                'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36',\n        },\n    })\n    const imgUrl = navResponse.data.wbi_img.img_url\n    const subUrl = navResponse.data.wbi_img.sub_url\n    const r =\n        imgUrl\n            .substring(imgUrl.lastIndexOf('/') + 1, imgUrl.length)\n            .split('.')[0] +\n        subUrl\n            .substring(subUrl.lastIndexOf('/') + 1, subUrl.length)\n            .split('.')[0]\n    const data = await axios.request({\n        url: 'https://s1.hdslb.com/bfs/seed/laputa-header/bili-header.umd.js',\n        headers: {\n            Referer: 'https://space.bilibili.com/1',\n            'user-agent':\n                'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Safari/537.36',\n        },\n    })\n    const array = JSON.parse(data.data.match(/\\[(?:\\d+,){63}\\d+\\]/))\n    const o: string[] = []\n    array.forEach((t: string) => {\n        r.charAt(t) && o.push(r.charAt(t))\n    })\n    return o.join('').slice(0, 32)\n}\n"]}